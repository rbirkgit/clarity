// Copyright (c) 2016-2018 VMware, Inc. All Rights Reserved.
// This software is released under MIT license.
// The full license information can be found in LICENSE in the root directory of this project.

@import './_menu-mixins.tango.scss';

%dropdown-content {
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;
}

@include exports('tng-dropdown.clarity') {
  .tng-dropdown {
    position: relative;
    display: inline-block;

    .tng-dropdown-toggle {
      display: inline-block;
      position: relative;
      margin: 0;
      white-space: nowrap;
      cursor: pointer;

      //No margins on any immediate dropdown-toggle children
      & > * {
        margin: 0;
      }

      clr-icon[shape^='caret'] {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: inherit;
        height: $clr-dropdown-caret-icon-dimension;
        width: $clr-dropdown-caret-icon-dimension;
      }

      &.btn {
        padding-right: $clr-button-horizontal-padding + $clr-dropdown-caret-icon-dimension +
          $clr-dropdown-caret-left-margin;

        clr-icon[shape^='caret'] {
          right: $clr-button-horizontal-padding;
        }
      }

      &:not(.btn) {
        padding: 0 $clr-dropdown-caret-icon-dimension + $clr-dropdown-caret-left-margin 0 0;
        color: $css-dropdown-active-text-color;
        clr-icon[shape^='caret'] {
          right: 0;
        }
      }
    }

    button.tng-dropdown-toggle:not(.btn) {
      background: transparent;
      border: none;
      cursor: pointer;
      color: $css-dropdown-active-text-color;
    }
  }

  //Dropdown Menu
  .tng-dropdown-menu > * {
    display: block;
    white-space: nowrap;
  }

  .tng-dropdown-menu {
    @include generate-dropdown-menu();

    .tng-dropdown-header {
      color: $css-dropdown-header-color;
      font-size: $clr-dropdown-header-font-size;
      font-weight: $clr-dropdown-header-font-weight;
      letter-spacing: $clr-dropdown-header-letter-spacing;

      padding: 0 $clr_baselineRem_0_5;
      line-height: $clr_baselineRem_0_75;
      margin: 0;

      @extend %dropdown-content;
    }

    .btn,
    .btn-secondary,
    .btn-info,
    .btn-outline,
    .btn-outline-primary,
    .btn-outline-secondary,
    .btn-outline-warning,
    .btn-outline-danger,
    .btn-outline-success,
    .btn-danger,
    .btn-primary,
    .btn-warning,
    .btn-success,
    .btn-link,
    .tng-dropdown-item {
      @include generate-dropdown-item();

      @extend %dropdown-content;

      &.expandable {
        $clr-dropdown-caret-margin-top: $clr_baselineRem_0_25;

        margin-right: $clr_baselineRem_1;
        padding-right: $clr_baselineRem_0_5;

        &:before {
          content: '';
          float: right;
          height: $clr_baselineRem_0_5;
          width: $clr_baselineRem_0_5;
          transform: rotate(-90deg);
          background-image: generateCaretIcon();
          @include icon-background-styles();
          margin-top: $clr-dropdown-caret-margin-top;
        }
      }
    }

    .btn,
    .tng-dropdown-item {
      @include generate-dropdown-item-height();
    }

    .tng-dropdown-divider {
      border-bottom: $clr-default-borderwidth solid $css-dropdown-divider-color;
      margin: $clr_baselineRem_0_25 0;
    }
  }

  //Directions
  .btn-group-overflow,
  .tabs-overflow,
  .tng-dropdown {
    $dropdown-menu-positional-nudge: $clr_baselineRem_2px;

    &.open > .tng-dropdown-menu,
    &.open > .tng-dropdown-menu-wrapper > .tng-dropdown-menu {
      visibility: visible;
    }

    &.bottom-left > .tng-dropdown-menu,
    &.bottom-right > .tng-dropdown-menu {
      top: 100%;
      bottom: auto;
      margin: $dropdown-menu-positional-nudge 0 0 0;
    }

    &.bottom-left > .tng-dropdown-menu {
      left: 0;
      right: auto;
    }

    &.bottom-right > .tng-dropdown-menu {
      right: 0;
      left: auto;
    }

    &.top-left > .tng-dropdown-menu,
    &.top-right > .tng-dropdown-menu {
      top: auto;
      bottom: 100%;
      margin: 0 0 $dropdown-menu-positional-nudge 0;
    }

    &.top-left > .tng-dropdown-menu {
      left: 0;
      right: auto;
    }

    &.top-right > .tng-dropdown-menu {
      right: 0;
      left: auto;
    }

    &.left-top > .tng-dropdown-menu,
    &.left-bottom > .tng-dropdown-menu {
      right: 100%;
      left: auto;
      margin: 0 $dropdown-menu-positional-nudge 0 0;
    }

    &.left-bottom > .tng-dropdown-menu {
      top: 0;
      bottom: auto;
    }

    &.left-top > .tng-dropdown-menu {
      bottom: 0;
      top: auto;
    }

    &.right-top > .tng-dropdown-menu,
    &.right-bottom > .tng-dropdown-menu {
      left: 100%;
      right: auto;
      margin: 0 0 0 $dropdown-menu-positional-nudge;
    }

    &.right-bottom > .tng-dropdown-menu {
      top: 0;
      bottom: auto;
    }

    &.right-top > .tng-dropdown-menu {
      bottom: 0;
      top: auto;
    }

    // nested dropdown (submenu)
    .tng-dropdown {
      $clr-dropdown-submenu-overlap-margin: -1 * $clr_baselineRem_4px;
      $clr-dropdown-submenu-vertical-margin: (-1 * $clr_baselineRem_0_75) - $clr_baselineRem_1px;
      // -1 is to account for the border that shifts the menu down by 1 pixel

      .tng-dropdown-menu {
        border-color: $css-dropdown-child-border-color;
        position: absolute;
      }

      &.left-top {
        > .tng-dropdown-menu,
        > .tng-dropdown-menu-wrapper > .tng-dropdown-menu {
          top: 0;
          bottom: auto;
          left: auto;
          right: 100%;
          margin-top: $clr-dropdown-submenu-vertical-margin;
          margin-right: $clr-dropdown-submenu-overlap-margin;
        }
      }
      &.right-top {
        > .tng-dropdown-menu,
        > .tng-dropdown-menu-wrapper > .tng-dropdown-menu {
          top: 0;
          bottom: auto;
          left: 100%;
          right: auto;
          margin-top: $clr-dropdown-submenu-vertical-margin;
          margin-left: $clr-dropdown-submenu-overlap-margin;
        }
      }
      &.left-bottom {
        > .tng-dropdown-menu,
        > .tng-dropdown-menu-wrapper > .tng-dropdown-menu {
          top: auto;
          bottom: 0;
          left: auto;
          right: 100%;
          margin-bottom: $clr-dropdown-submenu-vertical-margin;
          margin-right: $clr-dropdown-submenu-overlap-margin;
        }
      }
      &.right-bottom {
        > .tng-dropdown-menu,
        > .tng-dropdown-menu-wrapper > .tng-dropdown-menu {
          top: auto;
          bottom: 0;
          left: 100%;
          right: auto;
          margin-bottom: $clr-dropdown-submenu-vertical-margin;
          margin-left: $clr-dropdown-submenu-overlap-margin;
        }
      }
    }
  }
}
